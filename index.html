<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì›¹ ë¹Œë” V8</title>
    <!-- ì•„ì´ì½˜ ë¼ì´ë¸ŒëŸ¬ë¦¬ -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* ================= ì—ë””í„° UI ìŠ¤íƒ€ì¼ ================= */
        :root { --main: #3b82f6; --bg: #1e1e1e; --panel: #252526; --text: #e0e0e0; --border: #3e3e42; }
        * { box-sizing: border-box; }
        body { margin: 0; font-family: 'Pretendard', sans-serif; height: 100vh; display: flex; flex-direction: column; background: var(--bg); color: var(--text); overflow: hidden; }
        
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-thumb { background: #555; border-radius: 3px; }

        /* ìƒë‹¨ í—¤ë” */
        header { height: 50px; background: var(--panel); border-bottom: 1px solid var(--border); display: flex; align-items: center; justify-content: space-between; padding: 0 20px; z-index: 100; }
        .logo { font-weight: bold; color: var(--main); display: flex; align-items: center; gap: 8px; }
        .device-toggles button { background: none; border: none; color: #888; font-size: 16px; cursor: pointer; padding: 5px 10px; transition: 0.2s; }
        .device-toggles button:hover, .device-toggles button.active { color: white; }
        .btn-export { background: var(--main); color: white; border: none; padding: 8px 16px; border-radius: 4px; font-weight: bold; cursor: pointer; }
        .btn-export:hover { background: #2563eb; }

        /* ë©”ì¸ ì›Œí¬ìŠ¤í˜ì´ìŠ¤ */
        .workspace { flex: 1; display: flex; overflow: hidden; }

        /* ì™¼ìª½ ì‚¬ì´ë“œë°” (ë„êµ¬) */
        .sidebar-left { width: 260px; background: var(--panel); border-right: 1px solid var(--border); display: flex; flex-direction: column; }
        .sb-header { padding: 12px 15px; font-size: 12px; font-weight: bold; color: #999; border-bottom: 1px solid var(--border); margin-top: 10px; }
        .sb-header:first-child { margin-top: 0; }
        
        .tools-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 5px; padding: 10px; overflow-y: auto; }
        .tool-btn { 
            background: #333; border: 1px solid var(--border); color: #ccc; 
            padding: 10px; border-radius: 4px; cursor: pointer; font-size: 11px; 
            display: flex; flex-direction: column; align-items: center; gap: 6px; 
            transition: 0.2s; 
        }
        .tool-btn:hover { border-color: var(--main); color: var(--main); background: #2a2d3e; }
        
        /* ì¤‘ì•™ ìº”ë²„ìŠ¤ */
        .canvas-wrapper { flex: 1; background: #111; display: flex; justify-content: center; overflow-y: auto; padding: 40px; position: relative; }
        .canvas-bg { position: absolute; inset: 0; background-image: radial-gradient(#333 1px, transparent 1px); background-size: 20px 20px; pointer-events: none; }
        
        #canvas {
            background: white; width: 100%; max-width: 1000px; min-height: 800px; 
            box-shadow: 0 0 50px rgba(0,0,0,0.5); transition: width 0.3s ease;
            color: #333; position: relative; padding-bottom: 50px;
        }

        /* í¸ì§‘ ìš”ì†Œ ìŠ¤íƒ€ì¼ (ì—ë””í„° ì „ìš©) */
        .el-comp { position: relative; border: 2px solid transparent; min-height: 10px; transition: 0.1s; }
        .el-comp:hover { border-color: #cbd5e1; }
        .el-comp.selected { border-color: var(--main); z-index: 10; }
        .el-comp.selected::after {
            content: 'í¸ì§‘ ì¤‘'; position: absolute; top: -20px; right: 0; background: var(--main);
            color: white; font-size: 10px; padding: 2px 6px; border-radius: 4px 4px 0 0;
        }

        /* ì˜¤ë¥¸ìª½ ì‚¬ì´ë“œë°” (ì†ì„±) */
        .sidebar-right { width: 280px; background: var(--panel); border-left: 1px solid var(--border); display: flex; flex-direction: column; overflow-y: auto; }
        .prop-section { padding: 15px; border-bottom: 1px solid var(--border); }
        .prop-label { display: block; font-size: 11px; color: #999; margin-bottom: 6px; }
        
        input, select, textarea { width: 100%; background: #333; border: 1px solid var(--border); color: white; padding: 8px; border-radius: 4px; font-size: 12px; margin-bottom: 5px; }
        input[type="color"] { height: 30px; padding: 0; }
        input:focus { border-color: var(--main); outline: none; }

        .btn-group { display: flex; background: #333; border-radius: 4px; padding: 2px; margin-bottom: 5px; }
        .btn-group button { flex: 1; background: transparent; border: none; color: #aaa; padding: 6px; cursor: pointer; font-size: 11px; border-radius: 3px; }
        .btn-group button:hover { color: white; background: #444; }

        .box-model { display: grid; grid-template-columns: 1fr 2fr 1fr; gap: 4px; text-align: center; background: #1a1a1a; padding: 10px; border-radius: 4px; margin-top: 5px; }
        .box-input { width: 100%; text-align: center; background: transparent; border: 1px solid #444; color: #ddd; padding: 4px; font-size: 11px; }

        /* ìº”ë²„ìŠ¤ ë‚´ë¶€ ìš”ì†Œ ìŠ¤íƒ€ì¼ (ë‚´ë³´ë‚´ê¸° ëŒ€ìƒ) */
        .slider-container { position: relative; width: 100%; height: 300px; overflow: hidden; user-select: none; }
        .slider-img { position: absolute; top: 0; left: 0; width: 100%; height: 100%; object-fit: cover; }
        .slider-before { clip-path: polygon(0 0, 50% 0, 50% 100%, 0 100%); z-index: 2; }
        .slider-handle { position: absolute; top: 0; bottom: 0; left: 50%; width: 4px; background: white; z-index: 10; cursor: col-resize; display: flex; align-items: center; justify-content: center; }
        .slider-circle { width: 30px; height: 30px; background: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: #333; font-weight: bold; box-shadow: 0 2px 5px rgba(0,0,0,0.2); }
    </style>
</head>
<body>

    <header>
        <div class="logo"><i class="fas fa-cubes"></i> WEB BUILDER V8</div>
        <div class="device-toggles">
            <button class="active" onclick="resizeCanvas('100%')" title="PC"><i class="fas fa-desktop"></i></button>
            <button onclick="resizeCanvas('768px')" title="íƒœë¸”ë¦¿"><i class="fas fa-tablet-alt"></i></button>
            <button onclick="resizeCanvas('375px')" title="ëª¨ë°”ì¼"><i class="fas fa-mobile-alt"></i></button>
        </div>
        <button class="btn-export" onclick="exportHTML()"><i class="fas fa-download"></i> ë‚´ë³´ë‚´ê¸°</button>
    </header>

    <div class="workspace">
        <!-- ì™¼ìª½: ë„êµ¬ ìƒì -->
        <div class="sidebar-left">
            <div class="sb-header">ê¸°ë³¸ ìš”ì†Œ</div>
            <div class="tools-grid">
                <button class="tool-btn" onclick="addEl('h2')"><i class="fas fa-heading"></i> ì œëª©</button>
                <button class="tool-btn" onclick="addEl('p')"><i class="fas fa-paragraph"></i> ë³¸ë¬¸</button>
                <button class="tool-btn" onclick="addEl('img')"><i class="far fa-image"></i> ì´ë¯¸ì§€</button>
                <button class="tool-btn" onclick="addEl('btn')"><i class="fas fa-mouse-pointer"></i> ë²„íŠ¼</button>
            </div>

            <div class="sb-header">ë ˆì´ì•„ì›ƒ</div>
            <div class="tools-grid">
                <button class="tool-btn" onclick="addEl('div')"><i class="far fa-square"></i> ë°•ìŠ¤ (Div)</button>
                <button class="tool-btn" onclick="addEl('2col')"><i class="fas fa-columns"></i> 2ë‹¨ ì»¬ëŸ¼</button>
                <button class="tool-btn" onclick="addEl('spacer')"><i class="fas fa-arrows-alt-v"></i> ì—¬ë°±</button>
                <button class="tool-btn" onclick="addEl('divider')"><i class="fas fa-minus"></i> êµ¬ë¶„ì„ </button>
            </div>

            <div class="sb-header">ì¸í„°ë™í‹°ë¸Œ & ë¯¸ë””ì–´</div>
            <div class="tools-grid">
                <button class="tool-btn" onclick="addEl('slider')"><i class="fas fa-adjust"></i> ë¹„êµ ìŠ¬ë¼ì´ë”</button>
                <button class="tool-btn" onclick="addEl('youtube')"><i class="fab fa-youtube"></i> ìœ íŠœë¸Œ</button>
                <button class="tool-btn" onclick="addEl('tts')"><i class="fas fa-volume-up"></i> ì½ì–´ì£¼ê¸°(TTS)</button>
            </div>
            
            <div class="sb-header">êµ¬ì¡° (ë ˆì´ì–´)</div>
            <div id="layer-tree" style="padding:10px; color:#aaa; font-size:11px;">
                <!-- ë ˆì´ì–´ ëª©ë¡ -->
            </div>
        </div>

        <!-- ì¤‘ì•™: ìº”ë²„ìŠ¤ -->
        <div class="canvas-wrapper">
            <div class="canvas-bg"></div>
            <div id="canvas" onclick="deselect(event)">
                <!-- ì´ˆê¸° ì½˜í…ì¸  -->
                <div class="el-comp" style="padding: 60px 20px; text-align: center; background-color: #f8f9fa;">
                    <h1 style="margin: 0 0 20px 0; font-size: 2.5rem;">ë‚˜ë§Œì˜ ì›¹ì‚¬ì´íŠ¸ ë§Œë“¤ê¸°</h1>
                    <p style="color: #666; font-size: 1.1rem;">ì™¼ìª½ ë„êµ¬ì—ì„œ ìš”ì†Œë¥¼ ì¶”ê°€í•˜ê³ , í´ë¦­í•˜ì—¬ ì˜¤ë¥¸ìª½ì—ì„œ í¸ì§‘í•˜ì„¸ìš”.</p>
                </div>
            </div>
        </div>

        <!-- ì˜¤ë¥¸ìª½: ì†ì„± í¸ì§‘ -->
        <div class="sidebar-right" id="prop-panel">
            <div style="padding: 20px; text-align: center; color: #666; font-size: 12px;">
                ìš”ì†Œë¥¼ ì„ íƒí•˜ë©´<br>ì†ì„±ì°½ì´ ë‚˜íƒ€ë‚©ë‹ˆë‹¤.
            </div>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('canvas');
        const propPanel = document.getElementById('prop-panel');
        let selectedEl = null;

        // --- 1. ìš”ì†Œ ì¶”ê°€ ë¡œì§ ---
        function addEl(type) {
            let el;
            
            // ê¸°ë³¸ ìš”ì†Œ
            if(type === 'h2') { el = document.createElement('h2'); el.innerText = 'ì œëª© ì…ë ¥'; }
            else if(type === 'p') { el = document.createElement('p'); el.innerText = 'ì—¬ê¸°ì— ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”.'; }
            else if(type === 'img') { el = document.createElement('img'); el.src = 'https://via.placeholder.com/600x300'; el.style.maxWidth = '100%'; }
            else if(type === 'btn') { el = document.createElement('a'); el.innerText = 'ë²„íŠ¼ í´ë¦­'; el.href="#"; el.style.display='inline-block'; el.style.padding='10px 20px'; el.style.background='#3b82f6'; el.style.color='white'; el.style.borderRadius='4px'; el.style.textDecoration='none'; }
            
            // ë ˆì´ì•„ì›ƒ ìš”ì†Œ
            else if(type === 'div') { el = document.createElement('div'); el.innerText = 'ë°•ìŠ¤ ì˜ì—­'; el.style.padding='20px'; el.style.border='1px dashed #ccc'; }
            else if(type === '2col') {
                el = document.createElement('div');
                el.style.display = 'flex'; el.style.gap = '20px';
                el.innerHTML = `<div class="el-comp" style="flex:1; background:#f9f9f9; padding:20px;">ì™¼ìª½</div><div class="el-comp" style="flex:1; background:#f9f9f9; padding:20px;">ì˜¤ë¥¸ìª½</div>`;
            }
            else if(type === 'spacer') { el = document.createElement('div'); el.style.height = '50px'; }
            else if(type === 'divider') { el = document.createElement('hr'); el.style.margin = '20px 0'; el.style.border = '0'; el.style.borderTop = '1px solid #eee'; }

            // ì¸í„°ë™í‹°ë¸Œ ìš”ì†Œ
            else if(type === 'slider') {
                el = document.createElement('div');
                el.className = 'slider-container';
                el.innerHTML = `
                    <img src="https://via.placeholder.com/800x400/333/fff?text=AFTER" class="slider-img">
                    <div class="slider-img slider-before" style="background:url('https://via.placeholder.com/800x400/eee/000?text=BEFORE') no-repeat center/cover;"></div>
                    <div class="slider-handle"><div class="slider-circle">â†”</div></div>
                `;
                el.onmousemove = function(e) { handleSlide(e, this); };
            }
            else if(type === 'youtube') {
                el = document.createElement('div');
                el.innerHTML = '<iframe width="100%" height="350" src="https://www.youtube.com/embed/dQw4w9WgXcQ" frameborder="0" allowfullscreen style="pointer-events:none;"></iframe>';
            }
            else if(type === 'tts') {
                el = document.createElement('button');
                el.innerText = 'ğŸ”Š ì½ì–´ì£¼ê¸°';
                el.onclick = function() { alert('ë‚´ë³´ë‚´ê¸° í›„ ì‹¤ì œ ì‘ë™í•©ë‹ˆë‹¤.'); };
                el.style.padding='10px'; el.style.cursor='pointer';
            }

            // ê³µí†µ ì ìš©
            el.classList.add('el-comp');
            if(selectedEl && selectedEl !== canvas) selectedEl.appendChild(el);
            else canvas.appendChild(el);

            // í…ìŠ¤íŠ¸ í¸ì§‘ í™œì„±í™” (íŠ¹ìˆ˜ ìš”ì†Œ ì œì™¸)
            if(!['DIV','IFRAME'].includes(el.tagName) && !el.classList.contains('slider-container')) {
                el.setAttribute('contenteditable', 'true');
            }
            
            updateLayerTree();
        }

        // --- 2. ì„ íƒ ë° ì†ì„± í‘œì‹œ ---
        canvas.addEventListener('click', (e) => {
            e.preventDefault();
            if(e.target === canvas) return;
            e.stopPropagation();
            selectElement(e.target.closest('.el-comp') || e.target);
        });

        function selectElement(el) {
            if(selectedEl) selectedEl.classList.remove('selected');
            selectedEl = el;
            selectedEl.classList.add('selected');
            renderProperties();
        }

        function deselect(e) {
            if(e.target === canvas) {
                if(selectedEl) selectedEl.classList.remove('selected');
                selectedEl = null;
                propPanel.innerHTML = '<div style="padding:20px;text-align:center;color:#666;font-size:12px;">ìš”ì†Œë¥¼ ì„ íƒí•˜ì„¸ìš”</div>';
            }
        }

        // --- 3. ì†ì„± íŒ¨ë„ ---
        function renderProperties() {
            if(!selectedEl) return;
            
            let html = `<div class="prop-section">
                <span class="prop-label">ë°°ê²½ìƒ‰ / ê¸€ììƒ‰</span>
                <div style="display:flex; gap:5px;">
                    <input type="color" onchange="setStyle('backgroundColor', this.value)" title="ë°°ê²½ìƒ‰">
                    <input type="color" onchange="setStyle('color', this.value)" title="ê¸€ììƒ‰">
                    <button onclick="setStyle('backgroundColor', 'transparent')" style="font-size:11px; cursor:pointer;">íˆ¬ëª…</button>
                </div>
            </div>`;

            html += `<div class="prop-section">
                <span class="prop-label">ì •ë ¬ & í¬ê¸°</span>
                <div class="btn-group">
                    <button onclick="setStyle('textAlign', 'left')"><i class="fas fa-align-left"></i></button>
                    <button onclick="setStyle('textAlign', 'center')"><i class="fas fa-align-center"></i></button>
                    <button onclick="setStyle('textAlign', 'right')"><i class="fas fa-align-right"></i></button>
                </div>
                <input type="text" placeholder="ë„ˆë¹„ (ì˜ˆ: 100%, 500px)" onchange="setStyle('width', this.value)">
                <input type="text" placeholder="ë†’ì´ (ì˜ˆ: auto, 300px)" onchange="setStyle('height', this.value)">
            </div>`;

            html += `<div class="prop-section">
                <span class="prop-label">ì—¬ë°± (Margin / Padding)</span>
                <div class="box-model">
                    <div></div><input class="box-input" placeholder="ìƒ" onchange="setStyle('marginTop', this.value)"><div></div>
                    <input class="box-input" placeholder="ì¢Œ" onchange="setStyle('marginLeft', this.value)"><span style="font-size:9px; color:#666;">ë°”ê¹¥</span><input class="box-input" placeholder="ìš°" onchange="setStyle('marginRight', this.value)">
                    <div></div><input class="box-input" placeholder="í•˜" onchange="setStyle('marginBottom', this.value)"><div></div>
                </div>
                <div class="box-model" style="border:1px dashed #555">
                    <div></div><input class="box-input" placeholder="ìƒ" onchange="setStyle('paddingTop', this.value)"><div></div>
                    <input class="box-input" placeholder="ì¢Œ" onchange="setStyle('paddingLeft', this.value)"><span style="font-size:9px; color:#666;">ì•ˆìª½</span><input class="box-input" placeholder="ìš°" onchange="setStyle('paddingRight', this.value)">
                    <div></div><input class="box-input" placeholder="í•˜" onchange="setStyle('paddingBottom', this.value)"><div></div>
                </div>
            </div>`;

            html += `<div class="prop-section">
                <span class="prop-label">ë ˆì´ì•„ì›ƒ (Flex)</span>
                <div class="btn-group">
                    <button onclick="setStyle('display', 'block')">Block</button>
                    <button onclick="setStyle('display', 'flex')">Flex</button>
                </div>
                <div class="btn-group">
                    <button onclick="setStyle('justifyContent', 'flex-start')">ì™¼ìª½</button>
                    <button onclick="setStyle('justifyContent', 'center')">ì¤‘ì•™</button>
                    <button onclick="setStyle('justifyContent', 'space-between')">ë°°ë¶„</button>
                </div>
            </div>`;

            html += `<div class="prop-section">
                <button onclick="deleteElement()" style="width:100%; background:#ef4444; color:white; border:none; padding:10px; border-radius:4px; cursor:pointer;">ì‚­ì œí•˜ê¸°</button>
            </div>`;

            propPanel.innerHTML = html;
        }

        // --- 4. ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜ ---
        function setStyle(prop, val) {
            if(selectedEl) selectedEl.style[prop] = val;
        }

        function deleteElement() {
            if(selectedEl) {
                if(confirm('ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                    selectedEl.remove();
                    selectedEl = null;
                    propPanel.innerHTML = '';
                    updateLayerTree();
                }
            }
        }

        function resizeCanvas(size) {
            canvas.style.width = size;
            document.querySelectorAll('.device-toggles button').forEach(b => b.classList.remove('active'));
            event.currentTarget.classList.add('active');
        }

        function updateLayerTree() {
            const tree = document.getElementById('layer-tree');
            tree.innerHTML = '';
            Array.from(canvas.children).forEach(child => {
                let div = document.createElement('div');
                div.innerText = child.tagName.toLowerCase();
                div.style.padding = '4px 0';
                div.style.cursor = 'pointer';
                div.onclick = () => selectElement(child);
                tree.appendChild(div);
            });
        }

        function handleSlide(e, container) {
            const rect = container.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const percent = Math.max(0, Math.min(100, (x / rect.width) * 100));
            container.querySelector('.slider-before').style.clipPath = `polygon(0 0, ${percent}% 0, ${percent}% 100%, 0 100%)`;
            container.querySelector('.slider-handle').style.left = percent + '%';
        }

        // --- 5. ë‚´ë³´ë‚´ê¸° ---
        function exportHTML() {
            const clone = canvas.cloneNode(true);
            
            // í¸ì§‘ìš© ì†ì„± ì œê±°
            clone.querySelectorAll('.selected').forEach(el => el.classList.remove('selected'));
            clone.querySelectorAll('[contenteditable]').forEach(el => el.removeAttribute('contenteditable'));
            clone.querySelectorAll('.slider-container').forEach(el => el.removeAttribute('onmousemove'));
            clone.querySelectorAll('iframe').forEach(el => el.style.pointerEvents = 'auto');

            // ê¸°ëŠ¥ ë²„íŠ¼ ì—°ê²°
            clone.querySelectorAll('button').forEach(btn => {
                if(btn.innerText.includes('ì½ì–´ì£¼ê¸°')) btn.setAttribute('onclick', 'speakPage()');
            });

            const html = `
<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Website</title>
    <style>
        body { margin: 0; font-family: 'Pretendard', sans-serif; line-height: 1.6; }
        * { box-sizing: border-box; }
        img { max-width: 100%; display: block; }
        a { text-decoration: none; }
        
        .slider-container { position: relative; width: 100%; height: 350px; overflow: hidden; margin: 20px 0; user-select: none; }
        .slider-img { position: absolute; top: 0; left: 0; width: 100%; height: 100%; object-fit: cover; }
        .slider-before { clip-path: polygon(0 0, 50% 0, 50% 100%, 0 100%); z-index: 2; }
        .slider-handle { position: absolute; top: 0; bottom: 0; left: 50%; width: 4px; background: white; z-index: 10; cursor: col-resize; display: flex; align-items: center; justify-content: center; }
        .slider-circle { width: 30px; height: 30px; background: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: #333; font-weight: bold; box-shadow: 0 2px 5px rgba(0,0,0,0.2); }
    </style>
</head>
<body>
    <div style="max-width: 1000px; margin: 0 auto; background: white; min-height: 100vh;">
        ${clone.innerHTML}
    </div>

    <script>
        // ìŠ¬ë¼ì´ë” ê¸°ëŠ¥
        document.querySelectorAll('.slider-container').forEach(container => {
            container.addEventListener('mousemove', (e) => {
                const rect = container.getBoundingClientRect();
                const x = e.clientX - rect.left;
                const percent = Math.max(0, Math.min(100, (x / rect.width) * 100));
                container.querySelector('.slider-before').style.clipPath = \`polygon(0 0, \${percent}% 0, \${percent}% 100%, 0 100%)\`;
                container.querySelector('.slider-handle').style.left = percent + '%';
            });
        });

        // ì½ì–´ì£¼ê¸° (TTS)
        function speakPage() {
            window.speechSynthesis.cancel();
            const text = document.body.innerText;
            const msg = new SpeechSynthesisUtterance(text);
            msg.lang = 'ko-KR';
            window.speechSynthesis.speak(msg);
        }

        // ìš°í´ë¦­ ë°©ì§€
        document.addEventListener('contextmenu', e => e.preventDefault());
    <\/script>
</body>
</html>`;

            const blob = new Blob([html], {type: 'text/html'});
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = 'index.html';
            link.click();
        }
    </script>
</body>

</html>
